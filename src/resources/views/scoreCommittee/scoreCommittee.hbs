<style>
    th.dt-type-numeric.dt-orderable-asc.dt-orderable-desc {
        text-align: center;
    }
</style>
{{> header}}
<div class="content-wrapper" style="height: 100vh;">
    <div class="container-fluid">
        <div class="row" style="max-width: 100%; display: contents;">
            <ul class="search-customer"
                style="list-style: none; display:flex; justify-content: space-between; align-items: center;padding: 0;">
                <button class="btn btn-success" data-toggle="modal" data-target="#exampleModal">Thêm
                    mới</button>
                {{> modalScoreCommittee}}
            </ul>
        </div>
    </div>

    <div class="row" style="display: contents;">
        <div class="col-lg-6" style="max-width: 100%;">
            <div class="card">
                <div class="card-body">
                    <div class="table_header">
                        <span class="d-inline-block mb-3" tabindex="0" data-toggle="tooltip" title="Thùng rác của bạn">
                            <a href="/scoreCommittee/trashPage">
                                <ion-icon name="trash-outline">
                                </ion-icon>
                            </a>
                        </span>
                    </div>

                    <table id="myTableCommittee" class="table table-hover" style="font-size: 13px;">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Tên</th>
                                <th>Thời gian</th>
                                <th>Mặc định</th>
                                <th>Áp dụng</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each ScoreCommittee}}
                            <tr>
                                <th>{{plus @index}}</th>
                                <td>{{this.Name}}</td>
                                <td>{{year_name}}</td>
                                <td>
                                    {{#ifCond this.IsDefault 1}}
                                    <div class="active"></div>
                                    {{else}}
                                    <div class="inactive"></div>
                                    {{/ifCond}}
                                </td>
                                <td style="max-width: 40px;">
                                    {{#ifCond this.IsActive 1}}
                                    <div class="active"></div>
                                    {{else}}
                                    <div class="inactive"></div>
                                    {{/ifCond}}
                                </td>
                                <td>
                                    <div class="icons">
                                        <span class="d-inline-block" tabindex="0" data-toggle="tooltip"
                                            title="Mặc định">
                                            <ion-icon name="build-outline"></ion-icon>
                                        </span>
                                        <span class="d-inline-block" tabindex="0" data-toggle="tooltip"
                                            title="Chỉnh sửa">
                                            <ion-icon name="create-outline" data-toggle="modal"
                                                data-target="#ModalUpdateScoreCommittee{{this._id}}"></ion-icon>
                                        </span>
                                        {{!-- modal update scoreCommittee --}}
                                        <div class="modal fade" id="ModalUpdateScoreCommittee{{this._id}}" tabindex="-1"
                                            role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="exampleModalLabel">Cập nhật</h5>
                                                        <button type="button" class="close" data-dismiss="modal"
                                                            aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form>
                                                            <div class="form-row">
                                                                <div class="col-md-9 mb-3">
                                                                    <label for="Name">Tên hội đồng</label>
                                                                    <input name="Name" type="text" class="form-control"
                                                                        id="Name" value="{{this.Name}}" required>
                                                                </div>
                                                                <div class="custom-control custom-switch col-md-3"
                                                                    style="display: flex; justify-content: center;align-items: center;">
                                                                    {{#ifCond IsActive 1}}
                                                                    <input name="status" type="checkbox"
                                                                        class="custom-control-input"
                                                                        id="statusRole{{this._id}}" checked>
                                                                    <label class="custom-control-label block"
                                                                        for="statusRole{{this._id}}">Áp dụng</label>
                                                                    {{else}}
                                                                    <input name="status" type="checkbox"
                                                                        class="custom-control-input"
                                                                        id="statusRole{{this._id}}">
                                                                    <label class="custom-control-label block"
                                                                        for="statusRole{{this._id}}">Áp dụng</label>
                                                                    {{/ifCond}}
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <label for="yearReviewId">Thời gian</label>
                                                                    <select name="" class="form-control"
                                                                        id="yearReviewId">
                                                                        {{#each ../YearReview}}
                                                                        <option value="{{this._id}}" {{#ifCond this._id
                                                                            ../this.yearReviewId}}selected{{/ifCond}}>
                                                                            {{this.yearName}}
                                                                        </option>
                                                                        {{/each}}
                                                                    </select>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <label for="Note">Ghi chú</label>
                                                                    <input name="Note" type="text" class="form-control"
                                                                        id="Note">
                                                                </div>
                                                                <div class="col-md-12"
                                                                    style="display: flex;flex-direction: column;padding: 24px 0;">
                                                                    <p style="color: #F64E60;font-size: 13px;">Lưu ý</p>
                                                                    <p style="font-style: italic;font-size: 12px;">- Mỗi
                                                                        thành viên hội đồng có tối đa 1 thư ký.
                                                                    </p>
                                                                    <p style="font-style: italic;font-size: 12px;">- Kết
                                                                        quả chấm của thành viên hội đồng có thể
                                                                        được tham khảo từ kết quả chấm của thư ký chỉ
                                                                        đinh.</p>
                                                                </div>
                                                                <hr>
                                                                <div
                                                                    class="w-100 d-flex align-items-center justify-content-between">
                                                                    <p>Danh sách thành viên:</p>
                                                                    <button class="btn btn-info" type="button"
                                                                        data-toggle="modal"
                                                                        data-target="#exampleModalEmployee">Lựa
                                                                        chọn</button>
                                                                </div>
                                                                <div class=" col-md-12 mb-3 mt-3">
                                                                    <div class="panel-body">
                                                                        <table
                                                                            class="table table-bordered table__temptDetail">
                                                                            <thead>
                                                                                <tr style="font-size: 12px;">
                                                                                    <th scope="col">#</th>
                                                                                    <th scope="col">Tên</th>
                                                                                    <th scope="col">Tổ / Phòng ban</th>
                                                                                    <th scope="col">Vai trò</th>
                                                                                    <th scope="col">Tổ giúp việc</th>
                                                                                    <th scope="col"
                                                                                        style="max-width: 58px;text-wrap: wrap;">
                                                                                        Hành động</th>
                                                                                </tr>
                                                                            </thead>
                                                                            {{!-- body --}}
                                                                            <tbody id="education_fields"
                                                                                style="font-size: 12px;">
                                                                            </tbody>
                                                                            <tfoot>
                                                                                <tr>
                                                                                    <td colspan="8"
                                                                                        style="text-align: center;color: white;">
                                                                                        <button class="btn btn-success"
                                                                                            type="button"
                                                                                            onclick="education_fields();">
                                                                                            <span
                                                                                                class="glyphicon glyphicon-plus"
                                                                                                aria-hidden="true"></span>Thêm</button>
                                                                                    </td>
                                                                                </tr>
                                                                            </tfoot>
                                                                        </table>
                                                                        <div class="clear"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-danger"
                                                            data-dismiss="modal">Hủy bỏ</button>
                                                        <button type="button" class="btn btn-info">Lưu thông
                                                            tin</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {{!-- end modal update scoreCommittee --}}
                                        <span class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Xóa">
                                            <ion-icon id="icon_moveToTrash" name="trash-outline"
                                                data-id="{{this._id}}"></ion-icon>
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                    {{> modalListEmployee}}
                </div>
            </div>
        </div><!--End Row-->
    </div>
</div><!--End content-wrapper-->
{{> footer}}


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/assets/js/custom.js"></script>
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btnTrash = document.querySelectorAll('#icon_moveToTrash');
        for (let btn of btnTrash) {
            btn.addEventListener("click", (event) => {
                event.preventDefault();
                $.confirm({
                    title: '<ion-icon name="trash-bin-outline"></ion-icon>',
                    content: 'Bạn có chắc chắn muốn xóa ?',
                    buttons: {
                        confirm: {
                            text: 'Confirm',
                            btnClass: 'btn-red',
                            action: function () {
                                // Lấy ID của mục cần xóa từ thuộc tính data-id của nút
                                const id = event.target.dataset.id;

                                // Gọi API xóa mục
                                fetch(`/scoreCommittee/removeTrash/${id}`, {
                                    method: 'PATCH'
                                }).then(response => {
                                    if (response.ok) {
                                        $.alert('Xóa thành công!');
                                        setTimeout(() => {
                                            window.location.reload()
                                        }, 1000)
                                    } else {
                                        alert('Có lỗi xảy ra khi xóa mục');
                                    }
                                }).catch(error => {
                                    $.alert('Đã hủy');
                                });
                            }
                        },
                        cancel: function () {
                            $.alert('Đã hủy!');
                        }
                    }
                });
            });
        }
    })
</script>