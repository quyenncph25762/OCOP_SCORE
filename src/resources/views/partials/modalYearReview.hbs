{{!-- UPDATE --}}
{{#if this._id}}
<div class="modal fade" id="exampleModal{{this._id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal__size" role="document">
        <div class="modal-content model__content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Cập nhật năm đánh giá</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" class="width: 100%">
                <form>
                    <div class="form-row">
                        {{!-- title --}}
                        <div class="col-md-8 mb-3">
                            <label for="productGroup_name">Tên năm</label>
                            <input value="{{this.yearName}}" name="yearName" type="text" class="form-control"
                                id="yearName{{this._id}}" required>
                            <span
                                style="color: #de2935;font-size: 14px;font-style: italic;margin-top: 5px;font-weight: 600;"
                                id="messageErrorUpdate{{this._id}}"></span>
                        </div>
                        {{!-- status --}}
                        <div class="custom-control custom-switch col-md-3 ml-3"
                            style="display: flex; justify-content: center;align-items: center;">
                            {{#ifCond this.status 1}}
                            <input name="status" type="checkbox" class="custom-control-input" id="status{{this._id}}"
                                checked>
                            <label class="custom-control-label block" for="status{{this._id}}">Áp dụng</label>
                            {{else}}
                            <input name="status" type="checkbox" class="custom-control-input" id="status{{this._id}}">
                            <label class="custom-control-label block" for="status{{this._id}}">Áp dụng</label>
                            {{/ifCond}}
                        </div>
                        {{!-- note --}}
                        <div class="col-md-12 mb-3 mt-3">
                            <label for="note">Ghi
                                chú</label>
                            <input value="{{this.note}}" name="note" type="text" class="form-control"
                                id="note{{this._id}}">
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng</button>
                    <button onclick="handleUpdate('{{this._id}}')" class="btn btn-warning">Câp nhật năm đánh
                        giá</button>
                </div>
            </div>
        </div>
    </div>
</div>
{{/if}}
{{!-- POST --}}
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal__size" role="document">
        <div class="modal-content model__content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm mới năm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" class="width: 100%">
                <form>
                    <div class="form-row">
                        {{!-- creationUser --}}
                        <input type="text" id="creatorUser_id" name="creatorUser_id" value="{{User._id}}" hidden>
                        {{!-- title --}}
                        <div class="col-md-8 mb-3">
                            <label for="yearName">Số năm</label>
                            <input name="yearName" type="text" class="form-control" id="yearName" required>
                            <span style="color: #de2935;font-size: 14px;font-style: italic;margin-top: 5px;"
                                id="messageError"></span>
                        </div>
                        {{!-- status --}}
                        <div class="custom-control custom-switch col-md-3 ml-3"
                            style="display: flex; justify-content: center;align-items: center;">
                            <input name="status" type="checkbox" class="custom-control-input" id="status" checked>
                            <label class="custom-control-label block" for="status">Áp dụng</label>
                        </div>
                        {{!-- note --}}
                        <div class="col-md-12 mb-3 mt-3">
                            <label for="note">Ghi
                                chú</label>
                            <input name="note" type="text" class="form-control" id="note">
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng</button>
                    <button type="button" onclick="handleAdd()" class="btn btn-info">Thêm mới năm</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    async function handleAdd() {
        const yearName = document.getElementById(`yearName`).value
        const status = document.getElementById(`status`).checked
        const note = document.getElementById(`note`).value
        const creatorUser_id = document.getElementById(`creatorUser_id`).value
        if (yearName.trim() === "") {
            $.toast({
                position: "top-right",
                heading: 'WARNING!',
                text: "Năm đánh giá không được để trống",
                icon: 'warning',
                loader: true,
                loaderBg: '#f2a654',
                showHideTransition: 'slide',
                stack: 4
            });
            return
        }
        if (!Number(yearName)) {
            $.toast({
                position: "top-right",
                heading: 'WARNING!',
                text: "Năm đánh giá phải là số",
                icon: 'warning',
                loader: true,
                loaderBg: '#f2a654',
                showHideTransition: 'slide',
                stack: 4
            });
            return
        }
        const formData = new FormData()
        formData.append("yearName", yearName)
        formData.append("status", status)
        formData.append("note", note)
        formData.append("creatorUser_id", creatorUser_id)
        const res = await fetch(`/year-review/add`, {
            method: "POST",
            body: formData
        })
        if (res.ok) {
            const data = await res.json()
            localStorage.setItem('toast', JSON.stringify({
                position: "top-right",
                heading: 'Thêm thành công',
                text: 'Đã thêm thành công',
                icon: 'success',
                loader: true,
                loaderBg: '#9EC600',
                showHideTransition: 'slide',
                stack: 4
            }));
            window.location.replace("/year-review")
        } else {
            const data = await res.json()
            $.toast({
                position: "top-right",
                heading: 'WARNING!',
                text: data.message || 'Đã có lỗi xảy ra',
                icon: 'warning',
                loader: true,
                loaderBg: '#f2a654',
                showHideTransition: 'slide',
                stack: 4
            });
        }
    }
    //update
    async function handleUpdate(id) {
        const yearName = document.getElementById(`yearName${id}`).value
        const status = document.getElementById(`status${id}`).checked
        const note = document.getElementById(`note${id}`).value
        const formData = new FormData()
        formData.append("yearName", yearName)
        formData.append("status", status)
        formData.append("note", note)
        const res = await fetch(`/year-review/update/${id}`, {
            method: "POST",
            body: formData
        })
        if (res.ok) {
            const data = await res.json()
            localStorage.setItem('toast', JSON.stringify({
                position: "top-right",
                heading: 'Cập nhật thành công',
                text: 'Đã cập nhật thành công',
                icon: 'success',
                loader: true,
                loaderBg: '#9EC600',
                showHideTransition: 'slide',
                stack: 4
            }));
            window.location.replace("/year-review")
        } else {
            const data = await res.json()
            $.toast({
                position: "top-right",
                heading: 'WARNING!',
                text: data.message || 'Đã có lỗi xảy ra',
                icon: 'warning',
                loader: true,
                loaderBg: '#f2a654',
                showHideTransition: 'slide',
                stack: 4
            });
        }
    }
</script>